#include <i965.h>
#include <gui.h>

char cursor18x18[18*20] = {
	0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,//110000000000000000
	0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,//111000000000000000
	0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,//111100000000000000
	0,1,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,//110110000000000000
	0,1,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,//110011000000000000
	0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,//110001100000000000
	0,1,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,//110000110000000000
	0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,0,//110000011000000000
	0,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,//110000001100000000
	0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,//110000000110000000
	0,1,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,0,//110000000011000000
	0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,0,0,//110000000001100000
	0,1,2,2,2,2,2,2,2,1,1,1,1,1,0,0,0,0,//110000000000110000
	0,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0,0,0,//111110000011111000
	0,1,2,2,2,1,2,2,2,2,1,0,0,0,0,0,0,0,//100011000011000000
	0,1,2,2,1,1,2,2,2,2,1,0,0,0,0,0,0,0,//000000110011000000
	0,1,2,1,0,0,1,2,2,2,2,1,0,0,0,0,0,0,//000000011110000000
	0,1,1,0,0,0,1,2,2,2,2,1,0,0,0,0,0,0,//000000011110000000
	0,1,0,0,0,0,0,1,2,2,2,1,0,0,0,0,0,0,//000000011110000000
	0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,//000000110011000000
};
/*

0111110000000000000000
0111111000000000000000
0110111100000000000000
0110011110000000000000
0110001111000000000000
0110000111110000000000
0110000011111000000000
0110000001111100000000
0110000000011110000000
0110000000001111000000
0110000000000111100000
0110000000000011110000
0110000000000001111000
0110000000000000111100
0110000000000000011110
0110000000000000111110
0110000000011111111110
0110000010011111111100
0110000110011100000000
0110011111001110000000
0110111111001110000000
0111111111000111000000
0111110111100111000000
0111100011100011100000
0111000001110011100000
0000000001110001100000
0000000000111111100000
0000000000011111100000
*/
/*
char cursor18x18[16*28] = {
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,
0,1,2,2,1,0,0,0,0,0,0,0,0,0,0,0,
0,1,2,2,2,1,0,0,0,0,0,0,0,0,0,0,
0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,
0,1,2,2,2,2,2,1,0,0,0,0,0,0,0,0,
0,1,2,2,2,2,2,2,1,0,0,0,0,0,0,0,
0,1,2,2,2,2,2,2,2,1,0,0,0,0,0,0,
0,1,2,2,2,2,2,2,2,2,1,0,0,0,0,0,
0,1,2,2,2,2,2,2,2,2,2,1,0,0,0,0,
0,1,2,2,2,2,2,2,2,2,2,2,1,0,0,0,
0,1,2,2,2,2,2,2,2,2,2,2,2,1,0,0,
0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,
0,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,
0,1,2,2,2,2,2,2,2,1,1,1,1,1,1,0,
0,1,2,2,0,1,1,2,2,1,0,0,0,0,0,0,
0,1,2,2,1,0,0,1,2,2,1,0,0,0,0,0,
0,1,2,1,0,0,0,1,2,2,1,0,0,0,0,0,
0,1,1,0,0,0,0,0,1,2,2,1,0,0,0,0,
0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,
0,0,0,0,0,0,0,0,0,1,2,2,1,0,0,0,
0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};*/

void DrawMouse(unsigned int color, unsigned int *buffer,void *MouseBuffer)
{
	const char *font_data = (const char*) MouseBuffer;
	unsigned int mask;
	unsigned int *u;
	
	for(int t=0;t < 20;t++) {
	
		u = (unsigned int *) buffer + 64*t;
		
		for(int i= 0 ;i < 18;i ++)
		{
		 	mask = font_data[i+ (t*18)];
			
                     	if( mask == 1) {
                       	u[i] = color;
                       	
                     	}else if( mask == 2) {
                       	u[i] =0xff101020;
                     	}
                       
	
		}
			
		
	} 	

}


void setup_cursor(i965_t *dev)
{
	for(int i=0; i < 64*64; i++) {
	
		*(unsigned int*)(dev->cursor_memory + i*4) = 0;
	
	}
	
	
	DrawMouse(-1, (unsigned int *)(dev->cursor_memory),cursor18x18);
	
	int x = gui->horizontal_resolution/2;
	int y = gui->vertical_resolution/2;
	
	*(unsigned int*)(dev->mmio_base + 0x70080) = 0x7;
	
	*(unsigned int*)(dev->mmio_base + 0x70088) = (x &0x7fff) | (y &0x7fff) << 16;
	
	*(unsigned int*)(dev->mmio_base + 0x70084) = 0x700000; // dev->cursor_memory + address


}


void update_graphic_cursor(int x, int y ){

	if(!gtt->INTEL) return;
	

	*(unsigned int*)(gtt->mmio_base + 0x70088) = (x &0x7fff) | (y &0x7fff) << 16;
}
